<!DOCTYPE html>
<html lang="bg">
<head>
  <meta charset="utf-8">
  <title>Статистики – НВО и ДЗИ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="../css/fonts.css">
  <link rel="stylesheet" href="../css/normalize.css">
  <link rel="stylesheet" href="../css/skeleton.css">
  <link rel="stylesheet" href="../css/custom.css">
  <link rel="icon" type="image/png" href="../images/favicon-7.png">
  <!-- unsafe-eval е необходим за зареждане на данните в изолиран скоуп чрез new Function() -->
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval'; style-src 'self' 'unsafe-inline'; img-src 'self' data:; connect-src 'self'; font-src 'self'">
  <script src="../js/highcharts.js"></script>
  <style>
    .grade-btn { margin: 0 0.4rem 0.5rem 0; }
    .grade-btn.active { background: #33c3f0; border-color: #1eaedb; color: #fff; }
    .stat-section { margin-bottom: 3.5rem; }
    .stat-section h5 { border-bottom: 1px solid #e1e1e1; padding-bottom: 0.4rem; margin-bottom: 0.4rem; }
    .section-city-filter { margin: 0 0 0.7rem; display: flex; align-items: center; gap: 0.6rem; }
    .section-city-filter label { margin: 0; color: #444; font-size: 0.95em; }
    .city-filter-select { margin: 0; min-width: 210px; height: 34px; padding: 0 8px; }
    .stat-note { color: #666; font-size: 1em; margin: 0 0 0.3rem; }
    .stat-detail { color: #555; font-size: 1em; margin: 0 0 0.8rem; }
    .two-col { display: flex; gap: 2rem; flex-wrap: wrap; }
    .two-col > div { flex: 1; min-width: 260px; }
    #loading { text-align: center; padding: 5rem 0; color: #aaa; font-size: 1.1em; }
    table td, table th { padding: 3px 7px; font-size: 1em; }
    .pos { color: #27ae60; font-weight: bold; }
    .neg { color: #c0392b; font-weight: bold; }
  </style>
</head>
<body>
  <div class="container">

    <div style="margin:2rem 0 0.5rem">
      <a id="back-link" href="../">← Обратно</a>
    </div>

    <h3>Обобщена статистика – НВО и ДЗИ</h3>

    <div style="margin-bottom:2rem">
      <button class="button grade-btn" data-grade="4">НВО 4 клас</button>
      <button class="button grade-btn" data-grade="7">НВО 7 клас</button>
      <button class="button grade-btn" data-grade="10">НВО 10 клас</button>
      <button class="button grade-btn" data-grade="12">ДЗИ 12 клас</button>
    </div>

    <div id="loading">Зареждане...</div>

    <div id="stats-content" style="display:none">

      <!-- 1. Участие -->
      <div class="stat-section">
        <h5>Брой участващи училища и ученици по години</h5>
        <p class="stat-note">Брой училища с налични данни и брой регистрирани участия по двата предмета.</p>
        <p class="stat-detail">Дава контекст за представителността на останалите статистики. Ако броят на участващите училища се е увеличил значително, ранните години може да отразяват само по-добрите или по-добре документираните институции – което изкривява историческото сравнение. Ако броят намалява, може да сигнализира закриване на малки училища или промяна в методологията на данните. Броят на учениците показва реалния обхват на изпита и позволява да се прецени доколко националните средни са статистически надеждни.</p>
        <div id="chart-participation"></div>
      </div>

      <!-- 2. Национална средна -->
      <div class="stat-section">
        <h5>Национална средна по години</h5>
        <p class="stat-note">Претеглена средна по брой ученици за всички участващи училища.</p>
        <p class="stat-detail">Показва общата тенденция в представянето на национално ниво. Претеглянето по брой ученици дава по-точна картина, тъй като по-голямо училище има пропорционално по-голям принос. Силен спад може да отразява промяна в трудността на изпита, а не действителен спад в знанията – затова е добре да се разглежда заедно с информацията за конкретни години. Постоянно нарастване и по двата предмета едновременно е по-убедителен сигнал за системно подобрение.</p>
        <div id="chart-national"></div>
      </div>

      <!-- 3. Промяна по години -->
      <div class="stat-section">
        <h5>Промяна на националната средна по години</h5>
        <p class="stat-note">Разлика в претеглената средна спрямо предходната година за двата предмета.</p>
        <p class="stat-detail">Вместо абсолютни стойности, тук се вижда темпото на промяна. Положителна стойност означава подобрение спрямо предходната година, отрицателна – влошаване. Малко, но трайно положително изменение в продължение на няколко години е по-убедителен сигнал за системен напредък, отколкото еднократен голям скок, следван от спад. Рязка отрицателна промяна в конкретна година може да отразява промяна в методологията или трудността на изпита, а не реален спад в знанията – затова е полезно да се сравнява с данните за участие.</p>
        <div id="chart-yoy"></div>
      </div>

      <!-- 4. Перцентилен разрез -->
      <div class="stat-section">
        <h5>Перцентилен разрез по години</h5>
        <p class="stat-note">P10, P25, P50 (медиана), P75, P90 на средните оценки по училища за всяка година.</p>
        <p class="stat-detail">Националната средна крие много – едно добро цяло може да прикрива огромна пропаст между горните и долните 10%. Перцентилният разрез показва как се е движило представянето на слабите, средните и силните училища независимо едни от други. Ако P90 расте, а P10 стои, елитът напредва, но дъното не. Ако всички линии се придвижват нагоре успоредно, подобрението е системно. Смаляващият се „вентилатор" (линиите се доближават) означава намаляващо неравенство; разширяващият се – обратното.</p>
        <div id="chart-percentile-fan"></div>
      </div>

      <!-- 5. Неравенство -->
      <div class="stat-section">
        <h5>Неравенство между училищата по години</h5>
        <p class="stat-note">Стандартно отклонение на резултатите по всички участващи училища за всяка година.</p>
        <p class="stat-detail">Докато националната средна показва „накъде вървим като цяло", стандартното отклонение разкрива дали разликата между добрите и слабите училища нараства или намалява. Нарастващо отклонение означава по-голямо разслоение – елитните се отдалечават от слабите. Намаляващо може да означава нивелиране нагоре (всички се подобряват равномерно) или надолу (всички стават по-сходни, но и по-слаби). Разглеждан заедно с националната средна, тази графика дава пълна картина: ако средната расте и отклонението намалява едновременно, системата се подобрява по равен начин за всички.</p>
        <div id="chart-inequality"></div>
      </div>

      <!-- 6. Публични срещу частни -->
      <div class="stat-section">
        <h5>Публични срещу частни училища</h5>
        <p class="stat-note">Претеглена средна (двата предмета заедно) по години за двата типа училища.</p>
        <p class="stat-detail">Частните училища обичайно имат по-малки паралелки и избирателно приемане, което автоматично подобрява средните им резултати – тази графика не доказва причинно-следствена връзка между типа собственост и качеството на преподаване. Интересното е да се следи дали разликата се запазва стабилна или се изменя с годините. Нарастваща пропаст може да сигнализира задълбочаващо се неравенство в достъпа до качествено образование; стесняваща – или подобрение в публичните, или влошаване в частните.</p>
        <div id="chart-pubpriv"></div>
      </div>

      <!-- 7. Класация по градове -->
      <div class="stat-section">
        <h5>Класация по градове</h5>
        <p class="stat-note">Претеглена средна от всички налични години и всички училища в населеното място.</p>
        <p class="stat-detail">Позволява сравнение между населените места независимо от броя на училищата в тях. Полезно за семейства, обмислящи преместване, или за образователни политики, насочени към конкретни региони. Важно: висока средна може да се дължи на малко на брой, но силни и селективни учебни заведения – затова е добре да се разглежда заедно с реалния брой участващи ученици. Столицата невинаги е на върха – градовете с концентрирани профилирани гимназии може да имат по-висока средна от общо по-голям, но по-хетерогенен образователен пазар.</p>
        <div id="chart-city"></div>
      </div>

      <!-- 8. Географска концентрация на топ училища -->
      <div class="stat-section">
        <h5>Географска концентрация на топ училища</h5>
        <p class="stat-note">Брой от топ 15 по средна оценка в различните градове.</p>
        <p class="stat-detail">Показва дали отличните резултати са концентрирани в малко на брой градове или разпределени по-широко. Силна концентрация в един или два центъра означава, че достъпът до най-добрите учебни заведения е географски ограничен – важна информация при образователна политика и при избор на местоживеене. Ако класацията е доминирана от един град, интересно е да се провери дали това отразява реална гъстота на качествени училища или просто по-висок брой на участващи институции в региона.</p>
        <div id="chart-city-concentration"></div>
      </div>

      <!-- 9. Разпределение на резултатите -->
      <div class="stat-section">
        <h5>Разпределение на резултатите</h5>
        <p class="stat-note">Всеки запис е средната оценка на едно училище по един предмет за дадена година. Включени са всички училища, години и двата предмета.</p>
        <p class="stat-detail">Показва формата на разпределението – симетрично ли е, изтеглено ли е наляво (много слаби резултати) или надясно (много силни), има ли „два върха" (бимодалност). Бимодалното разпределение е особено показателно: предполага две ясно разграничени групи и липса на „средна класа" от учебни заведения. Колкото повече данни са включени, толкова по-надеждна е картината – затова се агрегират всички налични комбинации.</p>
        <div id="chart-dist"></div>
      </div>

      <!-- 10. Разпределение на размера на училищата -->
      <div class="stat-section">
        <h5>Разпределение на размера на училищата</h5>
        <p class="stat-note">Брой училища по групи размер (среден брой ученици на изпит).</p>
        <p class="stat-detail">Показва каква е типичната големина на учебното заведение за съответния клас. Разпределението е рядко симетрично – обикновено има дълга „опашка" вдясно от малко много големи училища. Контекстът е важен при интерпретация на другите графики: ако по-голямата част от училищата са малки, средните за цялата система се влияят непропорционално от тях. Тази графика помага да се прецени дали резултатите за „типичното" училище са по-близо до модата (най-честата група) или до средната стойност.</p>
        <div id="chart-size-dist"></div>
      </div>

      <!-- 11. БЕЛ срещу МАТ scatter -->
      <div class="stat-section">
        <h5>БЕЛ спрямо МАТ</h5>
        <p class="stat-note">Всяка точка е едно училище. Средни стойности за всички налични години.</p>
        <p class="stat-detail">Корелацията между двата предмета разкрива дали доброто представяне е „общо качество на образованието" или специализирано. При силна положителна корелация (точките следват диагонала) едно добро училище е добро и по двата предмета. Точки далеч от диагонала са интересни изключения – училища, силни в единия предмет, но слаби в другия. Профилираните гимназии (математически, езикови) обичайно се отклоняват от диагонала и са видими като ясни клъстери.</p>
        <div id="chart-bel-mat"></div>
      </div>

      <!-- 12. Разлика БЕЛ-МАТ -->
      <div class="stat-section">
        <h5>Най-голяма разлика между двата предмета</h5>
        <p class="stat-note">Училища с най-голяма абсолютна разлика между средната оценка по двата предмета (всички налични години).</p>
        <p class="stat-detail">Докато scatter графиката показва всички училища, тази таблица извежда крайните случаи – училищата с най-изразен дисбаланс. Родители на деца с изразена склонност към един от предметите може да намерят тук подходящи учебни заведения. Голяма разлика почти винаги отразява профила на училището – математическите гимназии доминират едната колона, езиковите – другата. Тясната специализация може да е предимство или недостатък в зависимост от интересите на конкретния ученик.</p>
        <div class="two-col">
          <div>
            <strong id="lbl-bel-leads">БЕЛ &gt; МАТ</strong>
            <table id="tbl-bel-leads" class="u-full-width"></table>
          </div>
          <div>
            <strong id="lbl-mat-leads">МАТ &gt; БЕЛ</strong>
            <table id="tbl-mat-leads" class="u-full-width"></table>
          </div>
        </div>
      </div>

      <!-- 13. Квадрантен анализ -->
      <div class="stat-section">
        <h5>Квадрантен анализ: ниво срещу тренд</h5>
        <p class="stat-note">Всяка точка е едно училище. Ос X: средна оценка за всички години. Ос Y: промяна за последните 5 години.</p>
        <p class="stat-detail">Четирите квадранта разграничават различни типове училища: горе-вдясно са „шампионите" (добри и подобряващи се), горе-вляво – „изгряващите" (слабо начало, но бърз растеж), долу-вдясно – „в упадък" (исторически силни, но влошаващи се), долу-вляво – „проблемните" (слаби и задълбочаващи спада). Линията по средата на X-оста е медианата на всички училища. Тази графика е особено полезна при избор на училище: „изгряващото" може да е по-добра инвестиция от трайно силното, ако е в достъпен район. „В упадък" е предупредителен сигнал дори при добра историческа репутация.</p>
        <div id="chart-quadrant"></div>
      </div>

      <!-- 14. Размер срещу резултат -->
      <div class="stat-section">
        <h5>Размер на училището спрямо резултат</h5>
        <p class="stat-note">Хоризонтална ос: среден брой ученици. Вертикална ос: среден резултат (двата предмета заедно).</p>
        <p class="stat-detail">Проверява дали по-малките или по-големите училища постигат по-добри резултати. Ако точките в горния ляв ъгъл са гъсто наситени, малките училища се справят по-добре; при горния десен – по-добре се справят по-големите. В много системи се наблюдава обратна U-образна форма: много малките и много големите изостават от средно-големите. Малките елитни училища с избирателно приемане може силно да изкривят картината в горния ляв ъгъл – тяхното превъзходство отразява типа ученици, а не задължително качеството на преподаване.</p>
        <div id="chart-size"></div>
      </div>

      <!-- 15. Стабилност спрямо размер -->
      <div class="stat-section">
        <h5>Стабилност спрямо размер на училището</h5>
        <p class="stat-note">Всяка точка е едно училище. Ос X: среден брой ученици. Ос Y: стандартно отклонение на резултата за последните 5 години.</p>
        <p class="stat-detail">Проверява дали по-малките или по-големите училища са по-непостоянни в резултатите си. Малките училища обичайно показват по-голямо отклонение – смяната на един добър учител или клас може драстично да промени средния резултат. Точки в горния ляв ъгъл (малки и нестабилни) носят по-висок риск: годината на кандидатстване може да се окаже лоша. Точки в долния десен ъгъл (големи и стабилни) предлагат по-предвидима среда. Тази графика помага да се прецени надеждността на репутацията на едно училище.</p>
        <div id="chart-stability-size"></div>
      </div>

      <!-- 16. Топ 15 по средна оценка -->
      <div class="stat-section">
        <h5>Топ 15 по средна оценка</h5>
        <p class="stat-note">Класация по средна стойност от всички налични години и двата предмета.</p>
        <p class="stat-detail">За разлика от таблицата с „напредък", тук водят абсолютните лидери – училищата с трайно най-висок среден резултат в целия наблюдаван период. Полезно за родители, търсещи учебното заведение с исторически най-добро и устойчиво представяне. Важно: малките специализирани училища с малко ученици и избирателно приемане обичайно доминират тук. Ако искате да намерите добро, но достъпно и по-голямо училище, разгледайте следващата таблица.</p>
        <table id="tbl-top" class="u-full-width"></table>
      </div>

      <!-- 17. Топ 15 при минимум ученици -->
      <div class="stat-section">
        <h5>Топ 15 сред по-достъпните училища</h5>
        <p class="stat-note">Класация само сред училища с брой ученици над медианата за съответния клас.</p>
        <p class="stat-detail">Таблицата с топ 15 обикновено е доминирана от малки, елитни и избирателни учебни заведения, чиято висока средна отразява типа приети ученици, а не задължително качеството на преподаване. Тази таблица филтрира онези и показва само училищата с брой участници над медианата – по-достъпните и по-широко представителни. Резултатите тук са по-показателни за ефективността на преподаване, а не само за селективността на приема. Полезно за родители, чиито деца нямат достъп до специализираните програми на малките елитни гимназии.</p>
        <table id="tbl-large-schools" class="u-full-width"></table>
      </div>

      <!-- 18. Напредък и спад -->
      <div class="stat-section">
        <h5>Напредък и спад</h5>
        <p class="stat-note">Сравнение на средния резултат (двата предмета) в първата и последната налична година в рамките на последните 5 години.</p>
        <p class="stat-detail">Показва кои училища са се подобрили или влошили най-много спрямо собствения си минал резултат. Добре допълва абсолютната класация: слабо училище, което се е подобрило значително, е по-ценна информация за родители на деца в района, отколкото стабилно силно училище, в което приемът е недостъпен. Обратно – спад в иначе силно училище е предупредителен сигнал, заслужаващ допълнително проучване.</p>
        <div class="two-col">
          <div>
            <strong>Най-голям напредък ↑</strong>
            <table id="tbl-improved" class="u-full-width"></table>
          </div>
          <div>
            <strong>Най-голям спад ↓</strong>
            <table id="tbl-declined" class="u-full-width"></table>
          </div>
        </div>
      </div>

      <!-- 19. Дял на подобряващите се по години -->
      <div class="stat-section">
        <h5>Дял на подобряващите се по години</h5>
        <p class="stat-note">Процент училища, подобрили, запазили или влошили резултата си спрямо предходната година.</p>
        <p class="stat-detail">Вместо да следим абсолютни средни, тук измерваме какъв дял от всички участващи училища са се подобрили, останали стабилни или влошили резултата си спрямо предходната година. Ако за дадена година зеленото (подобрили се) е явно доминиращо, системата е в позитивен тренд независимо от абсолютното ниво. Ако червеното (влошили се) нараства няколко поредни години, сигналът е тревожен дори ако националната средна все още изглежда прилична. Тази графика е по-устойчива на единични екстремни стойности, тъй като брои училища, а не усреднява резултати.</p>
        <div id="chart-improvement-rate"></div>
      </div>

      <!-- 20. Консистентно подобряващи се -->
      <div class="stat-section">
        <h5>Консистентно подобряващи се училища</h5>
        <p class="stat-note">Строго монотонно нарастване на средния резултат за всяка измерена година в наблюдавания период (минимум 4 точки от данни).</p>
        <p class="stat-detail">Тук са само онези училища, при които средният резултат е нараствал без изключение всяка измерена година. Това е значително по-строг критерий от „подобрило се като цяло" – изисква последователност без нито една лоша година. Такива училища демонстрират системна работа, а не просто добра или лоша случайност. Особено ценно е да се погледне дали тези училища присъстват и в класацията по абсолютно ниво – ако не, значи постоянно растящото, но все още „средно" училище може да е по-добрият избор за бъдещето.</p>
        <table id="tbl-consistent" class="u-full-width"></table>
      </div>

      <!-- 21. Най-стабилни -->
      <div class="stat-section">
        <h5>Най-стабилни училища</h5>
        <p class="stat-note">Ниско стандартно отклонение означава предвидими резултати. Изчислено върху последните 5 години.</p>
        <p class="stat-detail">Стабилността е отделно измерение от абсолютното ниво. Едно училище може да е добро средно, но много непостоянно – с отлични и лоши години редуващи се в зависимост от смяна на ръководство или учителски екип. Стабилните училища осигуряват предвидима учебна среда, което за много родители е също толкова важно, колкото средният резултат. Виждайки и двете колони (средна и σ) заедно, лесно се идентифицират истинските „надеждни" учебни заведения – тези с едновременно висок и постоянен резултат.</p>
        <table id="tbl-stable" class="u-full-width"></table>
      </div>

    </div><!-- #stats-content -->
  </div><!-- .container -->

  <script src="logic.js"></script>
</body>
</html>
