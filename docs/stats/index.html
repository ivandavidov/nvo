<!DOCTYPE html>
<html lang="bg">
<head>
  <meta charset="utf-8">
  <title>Статистики – НВО и ДЗИ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="../css/fonts.css">
  <link rel="stylesheet" href="../css/normalize.css">
  <link rel="stylesheet" href="../css/skeleton.css">
  <link rel="stylesheet" href="../css/custom.css">
  <link rel="icon" type="image/png" href="../images/favicon-7.png">
  <!-- unsafe-eval е необходим за зареждане на данните в изолиран скоуп чрез new Function() -->
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://www.googletagmanager.com https://www.google-analytics.com; style-src 'self' 'unsafe-inline'; img-src 'self' data: https://www.google-analytics.com; connect-src 'self' https://www.google-analytics.com https://region1.google-analytics.com; font-src 'self'">
  <meta name="referrer" content="strict-origin-when-cross-origin">
  <!-- Google Tag (GA4) with Consent Mode v2 -->
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('consent', 'default', {
      'analytics_storage': 'denied',
      'ad_storage': 'denied',
      'wait_for_update': 500
    });
  </script>
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-V0P6LBF76F"></script>
  <script>
    gtag('js', new Date());
    gtag('config', 'G-V0P6LBF76F', {'anonymize_ip': true});
  </script>
  <script src="../js/highcharts.js"></script>
  <style>
    .grade-btn { margin: 0 0.4rem 0.5rem 0; }
    .grade-btn.active { background: #33c3f0; border-color: #1eaedb; color: #fff; }
    .stat-section { margin-bottom: 3.5rem; }
    .stat-section h5 { border-bottom: 1px solid #e1e1e1; padding-bottom: 0.4rem; margin-bottom: 0.4rem; }
    .section-city-filter { margin: 0 0 0.7rem; display: flex; align-items: center; gap: 0.6rem; }
    .section-city-filter label { margin: 0; color: #444; font-size: 0.95em; }
    .city-filter-select { margin: 0; min-width: 210px; height: 34px; padding: 0 8px; }
    .stat-note { color: #666; font-size: 1em; margin: 0 0 0.3rem; }
    .stat-detail { color: #555; font-size: 1em; margin: 0 0 0.8rem; }
    .two-col { display: flex; gap: 2rem; flex-wrap: wrap; }
    .two-col > div { flex: 1; min-width: 260px; }
    #loading { text-align: center; padding: 5rem 0; color: #aaa; font-size: 1.1em; }
    table td, table th { padding: 3px 7px; font-size: 1em; }
    .pos { color: #27ae60; font-weight: bold; }
    .neg { color: #c0392b; font-weight: bold; }
  </style>
</head>
<body>
  <div class="container">

    <div style="margin:2rem 0 0.5rem">
      <a id="back-link" href="../">← Обратно</a>
    </div>

    <h3>Обобщена статистика – НВО и ДЗИ</h3>

    <div style="margin-bottom:2rem">
      <button class="button grade-btn" data-grade="4">НВО 4 клас</button>
      <button class="button grade-btn" data-grade="7">НВО 7 клас</button>
      <button class="button grade-btn" data-grade="10">НВО 10 клас</button>
      <button class="button grade-btn" data-grade="12">ДЗИ 12 клас</button>
    </div>

    <div id="loading">Зареждане...</div>

    <div id="stats-content" style="display:none">

      <!-- 1. Участие -->
      <div class="stat-section">
        <h5>Брой участващи училища и ученици по години</h5>
        <p class="stat-note">Показва колко училища и ученици влизат в данните всяка година.</p>
        <p class="stat-detail">Това е базов контекст за всички останали графики. Ако в дадена година участват много по-малко или много повече училища, сравненията с други години трябва да се четат по-внимателно.</p>
        <div id="chart-participation"></div>
      </div>

      <!-- 2. Национална средна -->
      <div class="stat-section">
        <h5>Национална средна по години</h5>
        <p class="stat-note">Среден резултат за страната по двата предмета.</p>
        <p class="stat-detail">Тук се вижда общата посока: има ли дългосрочно подобрение или спад. Полезно е да се гледа заедно с участието, за да се прецени дали промяната е масова или идва от по-тясна група училища.</p>
        <div id="chart-national"></div>
      </div>

      <!-- 3. Изгладен тренд -->
      <div class="stat-section">
        <h5>Национален тренд с изглаждане</h5>
        <p class="stat-note">Показва същите данни, но с по-гладка линия.</p>
        <p class="stat-detail">Изглаждането помага да се види основната тенденция, без да се реагира на еднократни скокове и спадове. Добър инструмент за по-стратегичен поглед.</p>
        <div id="chart-smoothed-trend"></div>
      </div>

      <!-- 4. Промяна по години -->
      <div class="stat-section">
        <h5>Промяна на националната средна по години</h5>
        <p class="stat-note">Колко е промяната спрямо предходната година.</p>
        <p class="stat-detail">Вместо да гледате само абсолютни стойности, тук виждате темпото. Положителните стойности са подобрение, отрицателните са влошаване.</p>
        <div id="chart-yoy"></div>
      </div>

      <!-- 5. Дял на подобряващите се -->
      <div class="stat-section">
        <h5>Дял на подобряващите се по години</h5>
        <p class="stat-note">Какъв процент училища се подобряват, запазват или влошават.</p>
        <p class="stat-detail">Тази графика показва дали подобрението е широко разпространено. Ако много училища едновременно вървят нагоре, това е по-силен сигнал от единични лидери.</p>
        <div id="chart-improvement-rate"></div>
      </div>

      <!-- 6. Перцентилен разрез -->
      <div class="stat-section">
        <h5>Перцентилен разрез по години</h5>
        <p class="stat-note">Показва слаби, средни и силни училища в отделни линии.</p>
        <p class="stat-detail">Тук лесно се вижда дали всички групи се движат заедно или разликата между тях расте. Ако горните линии се качват, а долните стоят, разслоението се увеличава.</p>
        <div id="chart-percentile-fan"></div>
      </div>

      <!-- 7. Неравенство -->
      <div class="stat-section">
        <h5>Неравенство между училищата по години</h5>
        <p class="stat-note">Колко голяма е разликата между училищата като цяло.</p>
        <p class="stat-detail">По-високата стойност означава по-голяма дистанция между силни и слаби училища. Полезно е да се гледа заедно с националната средна.</p>
        <div id="chart-inequality"></div>
      </div>

      <!-- 8. Публични срещу частни -->
      <div class="stat-section">
        <h5>Публични срещу частни училища</h5>
        <p class="stat-note">Сравнение на средните резултати по тип училище.</p>
        <p class="stat-detail">Това сравнение показва разлика, но не доказва причината за нея. Полезно е най-вече да се следи дали дистанцията между двата типа расте или намалява.</p>
        <div id="chart-pubpriv"></div>
      </div>

      <!-- 9. Класация по градове -->
      <div class="stat-section">
        <h5>Класация по градове</h5>
        <p class="stat-note">Среден резултат по град за целия период.</p>
        <p class="stat-detail">Дава бърз преглед кои градове са по-напред и кои изостават. Добре е да се комбинира с графиките за неравенство, защото средната не показва вътрешните разлики в самия град.</p>
        <div id="chart-city"></div>
      </div>

      <!-- 10. Индекс на неравенство по град -->
      <div class="stat-section">
        <h5>Индекс на неравенство по град</h5>
        <p class="stat-note">Показва колко различни са училищата вътре в един и същи град.</p>
        <p class="stat-detail">Два града могат да имат близка средна, но единият да е много по-неравен. Тази графика помага да видите именно това.</p>
        <div id="chart-city-inequality-index"></div>
      </div>

      <!-- 11. Конвергенция между градове -->
      <div class="stat-section">
        <h5>Конвергенция/дивергенция между градовете</h5>
        <p class="stat-note">Показва дали разликите между градовете се свиват или растат.</p>
        <p class="stat-detail">Когато линиите вървят надолу, градовете се изравняват. Когато вървят нагоре, разликата между водещи и изоставащи градове се увеличава.</p>
        <div id="chart-city-convergence"></div>
      </div>

      <!-- 12. Географска концентрация -->
      <div class="stat-section">
        <h5>Географска концентрация на топ училища</h5>
        <p class="stat-note">В кои градове са съсредоточени училищата от топ 15.</p>
        <p class="stat-detail">Тук се вижда дали най-силните училища са разпределени равномерно или са събрани в няколко града.</p>
        <div id="chart-city-concentration"></div>
      </div>

      <!-- 13. Разпределение на резултатите -->
      <div class="stat-section">
        <h5>Разпределение на резултатите</h5>
        <p class="stat-note">Показва колко често се срещат ниски, средни и високи резултати.</p>
        <p class="stat-detail">Дава обща картина за формата на данните. Може да покаже дали системата е по-скоро „средна“, или има ясно разделени групи училища.</p>
        <div id="chart-dist"></div>
      </div>

      <!-- 14. Разпределение на размера -->
      <div class="stat-section">
        <h5>Разпределение на размера на училищата</h5>
        <p class="stat-note">Показва колко са малките, средните и големите училища.</p>
        <p class="stat-detail">Тази графика дава контекст за останалите сравнения. Ако повечето училища са малки, крайностите в резултатите са по-вероятни.</p>
        <div id="chart-size-dist"></div>
      </div>

      <!-- 15. БЕЛ срещу МАТ -->
      <div class="stat-section">
        <h5 id="title-bel-mat">БЕЛ спрямо МАТ</h5>
        <p id="note-bel-mat" class="stat-note">Всяка точка е училище със среден резултат по двата предмета.</p>
        <p class="stat-detail">Ако точките вървят близо до диагонал, училищата са балансирани по двата предмета. Точките далеч от диагонала показват по-изразена специализация.</p>
        <div id="chart-bel-mat"></div>
      </div>

      <!-- 16. Разлика БЕЛ-МАТ -->
      <div class="stat-section">
        <h5 id="title-bel-mat-gap">Най-голяма разлика между двата предмета</h5>
        <p class="stat-note">Показва училищата с най-силен превес в единия предмет.</p>
        <p id="detail-bel-mat-gap" class="stat-detail">Таблиците са полезни, ако търсите училище с по-изразен профил. Лявата е за превес на БЕЛ, дясната за превес на МАТ.</p>
        <div class="two-col">
          <div>
            <strong id="lbl-bel-leads">БЕЛ &gt; МАТ</strong>
            <table id="tbl-bel-leads" class="u-full-width"></table>
          </div>
          <div>
            <strong id="lbl-mat-leads">МАТ &gt; БЕЛ</strong>
            <table id="tbl-mat-leads" class="u-full-width"></table>
          </div>
        </div>
      </div>

      <!-- 17. Стабилност на профила -->
      <div class="stat-section">
        <h5 id="title-profile-stability">Стабилност на предметния профил (БЕЛ-МАТ)</h5>
        <p class="stat-note">Показва дали профилът на училището се запазва във времето.</p>
        <p class="stat-detail">Може да видите кои училища имат устойчива силна страна и кои сменят профила си през годините.</p>
        <div id="chart-profile-stability"></div>
      </div>

      <!-- 18. Размер срещу резултат -->
      <div class="stat-section">
        <h5>Размер на училището спрямо резултат</h5>
        <p class="stat-note">Сравнява размера на училището и общия му среден резултат.</p>
        <p class="stat-detail">Графиката показва дали по-добрите резултати са по-чести при малки, средни или големи училища.</p>
        <div id="chart-size"></div>
      </div>

      <!-- 19. Стабилност спрямо размер -->
      <div class="stat-section">
        <h5>Стабилност спрямо размер на училището</h5>
        <p class="stat-note">Сравнява размера и колебливостта на резултатите.</p>
        <p class="stat-detail">Помага да видите кои училища са по-предвидими. Ниски стойности означават по-малки колебания между годините.</p>
        <div id="chart-stability-size"></div>
      </div>

      <!-- 20. Доверителност -->
      <div class="stat-section">
        <h5>Доверителност на резултата спрямо размер</h5>
        <p class="stat-note">Показва колко „шумен“ е резултатът според броя ученици.</p>
        <p class="stat-detail">При много малки випуски една силна или слаба паралелка влияе повече. Това помага да се различи стабилен резултат от случайно отклонение.</p>
        <div id="chart-confidence-size"></div>
      </div>

      <!-- 21. Квадрантен анализ -->
      <div class="stat-section">
        <h5>Квадрантен анализ: ниво срещу тренд</h5>
        <p class="stat-note">Ос X е средната оценка за целия период, а Ос Y е промяната за последните 5 години.</p>
        <p class="stat-detail">Промяната (Y) се смята като: среден резултат в най-новата година минус среден резултат в най-старата налична година от този 5-годишен прозорец. Над нулата означава подобрение, под нулата означава влошаване.</p>
        <div id="chart-quadrant"></div>
      </div>

      <!-- 22. Миграция между квадранти -->
      <div class="stat-section">
        <h5>Миграция между квадранти</h5>
        <p class="stat-note">Редът показва откъде тръгва училището, а колоната показва къде отива в следващата година.</p>
        <p class="stat-detail">Във всяка клетка има брой преходи и процент от съответния ред. Диагоналът означава, че училището е останало в същата група.</p>
        <p id="quadrant-migration-summary" class="stat-detail"></p>
        <table id="tbl-quadrant-migration" class="u-full-width"></table>
      </div>

      <!-- 23. Напредък и спад -->
      <div class="stat-section">
        <h5>Напредък и спад</h5>
        <p class="stat-note">Сравнява първата и последната година от последните 5 години.</p>
        <p class="stat-detail">Лявата таблица показва най-голям напредък, дясната най-голям спад. Полезно за бързо откриване на училища в промяна.</p>
        <div class="two-col">
          <div>
            <strong>Най-голям напредък ↑</strong>
            <table id="tbl-improved" class="u-full-width"></table>
          </div>
          <div>
            <strong>Най-голям спад ↓</strong>
            <table id="tbl-declined" class="u-full-width"></table>
          </div>
        </div>
      </div>

      <!-- 24. Консистентно подобряващи се -->
      <div class="stat-section">
        <h5>Консистентно подобряващи се училища</h5>
        <p class="stat-note">Тук влизат само училища с постоянно покачване без „лоша“ година.</p>
        <p class="stat-detail">Това е по-строг критерий от „общо подобрение“. Показва къде напредъкът е най-последователен.</p>
        <table id="tbl-consistent" class="u-full-width"></table>
      </div>

      <!-- 25. Най-стабилни -->
      <div class="stat-section">
        <h5>Най-стабилни училища</h5>
        <p class="stat-note">Класация на училища с най-малки колебания в резултатите.</p>
        <p class="stat-detail">Подходящо, ако търсите предвидимост, а не само висок пик в отделна година.</p>
        <table id="tbl-stable" class="u-full-width"></table>
      </div>

      <!-- 26. Ранг-стабилност -->
      <div class="stat-section">
        <h5>Ранг-стабилност по години</h5>
        <p class="stat-note">Показва дали училището държи сходно място в класацията през времето.</p>
        <p class="stat-detail">Така се различават трайните лидери от училища с единични върхове.</p>
        <div id="chart-rank-stability"></div>
      </div>

      <!-- 27. Топ 15 -->
      <div class="stat-section">
        <h5>Топ 15 по средна оценка</h5>
        <p class="stat-note">Най-висока обща средна оценка за целия период.</p>
        <p class="stat-detail">Това е директната класация по ниво. Добре е да се комбинира със секциите за стабилност и тренд.</p>
        <table id="tbl-top" class="u-full-width"></table>
      </div>

      <!-- 28. Топ 15 сред по-достъпните -->
      <div class="stat-section">
        <h5>Топ 15 сред по-достъпните училища</h5>
        <p class="stat-note">Топ класация, но само сред училища с по-голям брой ученици.</p>
        <p class="stat-detail">Този филтър намалява влиянието на много малки и силно селективни училища и дава по-практичен списък за повечето семейства.</p>
        <table id="tbl-large-schools" class="u-full-width"></table>
      </div>

      <!-- 29. Разлика спрямо бенчмарки -->
      <div class="stat-section">
        <h5>Разлика спрямо национална и градска средна</h5>
        <p class="stat-note">Показва с колко точки училището е над или под средното.</p>
        <p class="stat-detail">Това е удобен начин да видите стойността на училището спрямо две рамки: цялата страна и собствения град.</p>
        <div class="two-col">
          <div>
            <strong>Над националната средна</strong>
            <table id="tbl-delta-over" class="u-full-width"></table>
          </div>
          <div>
            <strong>Под националната средна</strong>
            <table id="tbl-delta-under" class="u-full-width"></table>
          </div>
        </div>
      </div>

      <!-- 30. Персистентни топ/дъно -->
      <div class="stat-section">
        <h5>Персистентни топ/дъно 10%</h5>
        <p class="stat-note">Колко често училището е в най-горните или най-долните 10%.</p>
        <p class="stat-detail">Така се вижда дали позицията е случайна или се повтаря стабилно във времето.</p>
        <div class="two-col">
          <div>
            <strong>Устойчиво в топ 10%</strong>
            <table id="tbl-persistent-top" class="u-full-width"></table>
          </div>
          <div>
            <strong>Устойчиво в дъно 10%</strong>
            <table id="tbl-persistent-bottom" class="u-full-width"></table>
          </div>
        </div>
      </div>

      <!-- 31. Композитен индекс -->
      <div class="stat-section">
        <h5>Композитен индекс: ниво + стабилност + тренд</h5>
        <p class="stat-note">Един общ индекс за по-бързо сравнение между училищата.</p>
        <p class="stat-detail">Индексът съчетава текущо ниво, стабилност и посока на развитие. Ползвайте го като ориентир, а после отваряйте детайлните графики за контекст.</p>
        <table id="tbl-composite" class="u-full-width"></table>
      </div>

    </div><!-- #stats-content -->
  </div><!-- .container -->

  <script src="logic.js"></script>
</body>
</html>
