<!DOCTYPE html>
<html lang="bg">
<head>
  <meta charset="utf-8">
  <title>Snake</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="../../css/fonts.css">
  <link rel="stylesheet" href="../../css/normalize.css">
  <link rel="stylesheet" href="../../css/skeleton.css">
  <link rel="stylesheet" href="../../css/custom.css">
  <style>
    .panel { max-width: 520px; margin: 0 auto; }
    canvas { width: 100%; max-width: 360px; display:block; margin: 0 auto; border:1px solid #ccc; background:#fff; image-rendering: pixelated; }
    .meta { display:flex; justify-content:space-between; margin-bottom:8px; color:#555; }
    .ctrl { margin-top:10px; display:grid; gap:6px; grid-template-columns:repeat(3,1fr); max-width:360px; margin-left:auto; margin-right:auto; }
    .ctrl button { margin:0; padding:0; height:38px; }
    .ctrl .wide { grid-column: span 3; }
  </style>
</head>
<body>
  <div class="container">
    <div class="row" style="margin-top:2rem"><a href="../">← Към игрите</a></div>
    <div class="row panel">
      <h4>Snake</h4>
      <div class="meta"><span>Точки: <strong id="score">0</strong></span><span>Скорост: <strong id="speed">1x</strong></span></div>
      <canvas id="c" width="360" height="360"></canvas>
      <div style="margin-top:8px; color:#666; text-align:center;">Клавиши: ← ↑ → ↓, Space за пауза</div>
      <div class="ctrl">
        <button id="up" class="button">↑</button>
        <button id="pause" class="button">Пауза</button>
        <button id="reset" class="button">Нова игра</button>
        <button id="left" class="button">←</button>
        <button id="down" class="button">↓</button>
        <button id="right" class="button">→</button>
      </div>
    </div>
  </div>
  <script>
  'use strict';
  const SIZE = 18;
  const CELL = 20;
  const BG = '#fdfdfd';
  const ctx = document.getElementById('c').getContext('2d');
  const scoreEl = document.getElementById('score');
  const speedEl = document.getElementById('speed');
  let snake, dir, nextDir, food, score, timer, paused;

  function rnd(max){ return (Math.random()*max)|0; }
  function placeFood(){
    while(true){
      const p = {x:rnd(SIZE), y:rnd(SIZE)};
      if(!snake.some(s=>s.x===p.x&&s.y===p.y)) return p;
    }
  }

  function reset(){
    snake = [{x:8,y:9},{x:7,y:9},{x:6,y:9}];
    dir = {x:1,y:0};
    nextDir = {x:1,y:0};
    score = 0;
    paused = false;
    food = placeFood();
    scoreEl.textContent = '0';
    speedEl.textContent = '1x';
    if(timer) clearInterval(timer);
    timer = setInterval(tick, 140);
    draw();
  }

  function setDir(x,y){
    if(x === -dir.x && y === -dir.y) return;
    nextDir = {x,y};
  }

  function tick(){
    if(paused) return;
    dir = nextDir;
    const head = {x: snake[0].x + dir.x, y: snake[0].y + dir.y};
    if(head.x < 0 || head.y < 0 || head.x >= SIZE || head.y >= SIZE || snake.some(s=>s.x===head.x&&s.y===head.y)){
      paused = true;
      return;
    }
    snake.unshift(head);
    if(head.x === food.x && head.y === food.y){
      score += 10;
      scoreEl.textContent = String(score);
      const speed = Math.min(2.4, 1 + score / 200);
      speedEl.textContent = speed.toFixed(1) + 'x';
      clearInterval(timer);
      timer = setInterval(tick, Math.max(70, 140 - score));
      food = placeFood();
    } else {
      snake.pop();
    }
    draw();
  }

  function draw(){
    ctx.fillStyle = BG;
    ctx.fillRect(0,0,360,360);
    ctx.strokeStyle = '#eee';
    for(let i=0;i<=SIZE;i++){
      ctx.beginPath(); ctx.moveTo(i*CELL,0); ctx.lineTo(i*CELL,360); ctx.stroke();
      ctx.beginPath(); ctx.moveTo(0,i*CELL); ctx.lineTo(360,i*CELL); ctx.stroke();
    }
    ctx.fillStyle = '#27ae60';
    snake.forEach((s,i)=>{
      ctx.fillStyle = i===0 ? '#1e8449' : '#27ae60';
      ctx.fillRect(s.x*CELL+1,s.y*CELL+1,CELL-2,CELL-2);
    });
    ctx.fillStyle = '#e74c3c';
    ctx.fillRect(food.x*CELL+2, food.y*CELL+2, CELL-4, CELL-4);
    if(paused){
      ctx.fillStyle = 'rgba(255,255,255,0.7)';
      ctx.fillRect(70,150,220,60);
      ctx.fillStyle = '#333';
      ctx.font = 'bold 24px sans-serif';
      ctx.textAlign = 'center';
      ctx.fillText('Пауза / Край',180,188);
    }
  }

  document.addEventListener('keydown', e => {
    if(e.key === 'ArrowLeft') setDir(-1,0);
    if(e.key === 'ArrowRight') setDir(1,0);
    if(e.key === 'ArrowUp') setDir(0,-1);
    if(e.key === 'ArrowDown') setDir(0,1);
    if(e.code === 'Space') paused = !paused;
  });

  document.getElementById('left').onclick = ()=>setDir(-1,0);
  document.getElementById('right').onclick = ()=>setDir(1,0);
  document.getElementById('up').onclick = ()=>setDir(0,-1);
  document.getElementById('down').onclick = ()=>setDir(0,1);
  document.getElementById('pause').onclick = ()=>{ paused = !paused; draw(); };
  document.getElementById('reset').onclick = reset;

  reset();
  </script>
</body>
</html>
